<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="D√©couvrez la nouvelle radio du valenciennois VAFM et les derni√®res actualit√©s." />
  <title>VAFM - La radio qu'il vous faut</title>
  <link rel="icon" type="image/png" sizes="32x32" href="assets/VAFM logo rouge.png" />
  <link rel="stylesheet" href="style.css?v=2">
  <script src="principal.js" defer></script>
  <meta name="google-adsense-account" content="ca-pub-8497430727637938">

  <!-- Google Tag Manager -->
  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KJSC6Z4M');
  </script>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QNVR8XET7E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-QNVR8XET7E');
  </script>

  <!-- AdSense : charger le script UNE SEULE FOIS -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8497430727637938" crossorigin="anonymous"></script>
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KJSC6Z4M"
    height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>

  <div class="page-wrapper">
    <header class="top-bar">
      <div class="logo-zone">
        <img src="assets/erasebg-transformed.png" alt="VAFM" class="logo">
      </div>
      <div class="hamburger" id="menuToggle" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </header>

    <div class="sub-bar"></div>

    <nav class="side-menu" id="sideMenu">
      <a href="index.html">Accueil</a>
      <a href="equipe.html">Notre √©quipe</a>
      <a href="direct.html">√âcouter le direct</a>
      <a href="programmes.html">Programmes</a>
      <a href="histoire.html">Histoire</a>
      <a href="don.html">Don</a>
      <div class="social-links">
        <a href="https://www.facebook.com/profile.php?id=61573373138285"><img src="assets/facebook.png" alt="Facebook"></a>
        <a href="https://www.instagram.com/vafmlaradio/"><img src="assets/instagram.png" alt="Instagram"></a>
        <a href="https://www.youtube.com/@VAFMlaradio"><img src="assets/youtube.png" alt="YouTube"></a>
        <a href="https://www.tiktok.com/@vafmlaradio"><img src="assets/tiktok.png" alt="TikTok"></a>
      </div>
    </nav>

<section class="hero-banner">
  <img src="assets/logo vafm 3.png" alt="Bienvenue sur VAFM" class="hero-image distant">
  <div class="fade-overlay"></div>

<div class="mini-player-zone">
  <div class="mini-player-card">
    <img src="https://manager4.streamradio.fr:1130/media/widgets/VAFM.png" alt="VAFM" class="mini-cover" />
    <div class="mini-info">
      <h3>VAFM</h3>
      <p id="currentTrack">Chargement du titre...</p>
      <button id="playBtn" class="play-btn">‚ñ∂ √âcouter</button>
    </div>
  </div>

  <!-- Flux audio -->
  <audio id="miniAudio" preload="none">
    <source src="https://manager10.streamradio.fr:1555/stream" type="audio/mpeg">
    Ton navigateur ne supporte pas l‚Äôaudio HTML5.
  </audio>
</div>

  <div class="hero-text">
    <h3>Bienvenue sur VAFM</h3>
    <p>VAFM est la webradio du Valenciennois. Nous diffusons des √©missions locales, des interviews, des reportages et des d√©dicaces en direct.</p>
    <p>Notre √©quipe est compos√©e de b√©n√©voles passionn√©s qui font vibrer les ondes chaque jour.</p>
  </div>
</section>
  
</div> 
    <link rel="stylesheet" 
    type="text/css" href="https://manager4.streamradio.fr:1130/media/static/css/current_track_widget/status_widget.css" />
    <script type="text/javascript"
    src="https://manager4.streamradio.fr:1130/media/static/js/current_track_widget/status_widget.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8497430727637938" crossorigin="anonymous"></script>
<!-- accueil haut 2 -->
<ins class="adsbygoogle"
     style="display:inline-block; width:320px; height:100px;"
     data-ad-client="ca-pub-8497430727637938"
     data-ad-slot="5908785498"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
    
    <main class="container">
      <div class="article-card" onclick="openPopup('popup-braderie')">
        <img src="assets/braderie lille.jpeg" alt="Braderie de Lille" class="card-image" />
        <div class="card-content">
          <h3>Retour sur la Braderie de Lille 2025</h3>
          <p>Ce week-end, la capitale des Flandres a une nouvelle fois vibr√© au rythme de sa c√©l√®bre Braderie...</p>
        </div>
      </div>
      
      <div class="article-card" onclick="openPopup('popup-recrutement')">
        <img src="assets/vafm-recrute.jpg" alt="VAFM recrute" class="card-image" />
        <div class="card-content">
          <h3>VAFM recrute !</h3>
          <p>La radio VAFM recrute des b√©n√©voles passionn√©s pour rejoindre son √©quipe !</p>
        </div>
      </div>
      
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8497430727637938"
     crossorigin="anonymous"></script>
<!-- accueil haut dedicasse -->
<ins class="adsbygoogle"
     style="display:inline-block; width:320px; height:100px;"
     data-ad-client="ca-pub-8497430727637938"
     data-ad-slot="4674567208"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
  
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      <div class="dedicace-marquee">
        <div class="dedicace-track" id="dedicaceMarquee"></div>
      </div>

      <section class="live-dedicace">
        <h2>D√©dicace</h2>
        <form id="dedicaceForm">
          <input type="text" id="nom" placeholder="Ton pr√©nom ou pseudo" required />
          <textarea id="message" placeholder="Ta d√©dicace..." maxlength="60" required></textarea>
          <p id="charCount">60 caract√®res restants</p>
          <button type="submit">Envoyer</button>
        </form>
        <div id="dedicaceFeed" class="dedicace-feed"></div>
      </section>

      <div style="text-align: center; margin-top: 30px;">
        <a href="https://www.facebook.com/la.touche.personnelle.2024" target="_blank" rel="noopener">
          <img src="assets/PUB thomas.png" alt="La Touche Personnelle" style="max-width:50%;height:auto;border-radius:12px;" />
        </a>
      </div>
    </main>
    
<!-- Popups -->
<div id="popup-braderie" class="popup hidden">
  <div class="popup-content">
    <button class="close-btn" onclick="closePopup('popup-braderie')">‚úñ</button>
    <img src="assets/braderie lille.jpeg" alt="Braderie de Lille" class="popup-image" />
    <h2>Retour sur la Braderie de Lille 2025</h2>
    <p>
      Ce week-end, la capitale des Flandres a une nouvelle fois vibr√© au rythme de sa c√©l√®bre Braderie...
    </p>
  </div>
</div>

<div id="popup-recrutement" class="popup hidden">
  <div class="popup-content">
    <button class="close-btn" onclick="closePopup('popup-recrutement')">‚úñ</button>
    <img src="assets/vafm-recrute.jpg" alt="VAFM recrute" class="popup-image" />
    <h2>VAFM recrute !</h2>
    <p>
      La radio VAFM recrute des b√©n√©voles passionn√©s pour rejoindre son √©quipe !<br><br>
      Tu r√™ves de faire de la radio ? Tu parles plus vite qu‚Äôun animateur de jeu t√©l√© ? Tu as des choses √† dire ?<br>
      C‚Äôest le moment !<br><br>
      Nous recherchons :<br>
      üîπ Journalistes, animateurs, reporters b√©n√©voles<br><br>
      üìª Enregistrement √† distance, üéß micro net, üéôÔ∏è passion + rigueur + d√©mo audio<br><br>
      üëâ Envoie ta d√©mo (2-3 min)<br>
      üì© contact.vafm@gmail.com<br>
      üåê <a href="https://hvk-nox-zfr.github.io/vafm/index.html" target="_blank" rel="noopener">Site VAFM</a><br><br>
      √Ä tr√®s vite dans nos oreilles !<br>‚Äî L‚Äô√©quipe de VAFM
    </p>
  </div>
</div>

<!-- Footer -->
<footer class="site-footer">
  <div class="footer-content">
    <div class="footer-logo">
      <img src="assets/logo gris vafm.png" style="height:250px;" alt="Logo VAFM" />
    </div>
    <div class="footer-links">
      <a href="contact.html">Nous contacter</a>
      <a href="mentions.html">Mentions l√©gales</a>
      <a href="a-propos.html">√Ä propos</a>
      <a href="accessibilite.html">Accessibilit√©</a>
      <a href="politique.html">Politique de confidentialit√©</a>
    </div>
  </div>
  <div class="footer-bottom">
    <p>¬© 2025 VAFM | Tous droits r√©serv√©s.</p>
  </div>
</footer>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const playBtn = document.getElementById("playBtn");
    const audio = document.getElementById("miniAudio");

    playBtn.addEventListener("click", function () {
      if (audio.paused) {
        audio.play().catch(err => console.error("Erreur de lecture :", err));
        playBtn.textContent = "‚è∏ Pause"; // change le texte du bouton
      } else {
        audio.pause();
        playBtn.textContent = "‚ñ∂ √âcouter"; // remet le texte initial
      }
    });
  });
</script>

<!-- Gestion du formulaire de d√©dicace et du marquee -->
<script>
(function initDedicaces() {
  const db = firebase.database();

  const form = document.getElementById('dedicaceForm');
  const feed = document.getElementById('dedicaceFeed');
  const marquee = document.getElementById('dedicaceMarquee');
  const msgInput = document.getElementById('message');
  const nomInput = document.getElementById('nom');
  const charCount = document.getElementById('charCount');
  const file = [];

  if (!form || !feed || !marquee || !msgInput || !nomInput) return;

  // compteur de caract√®res
  msgInput.addEventListener('input', () => {
    const max = parseInt(msgInput.getAttribute('maxlength') || '60', 10);
    const rem = Math.max(0, max - msgInput.value.length);
    charCount.textContent = rem + ' caract√®res restants';
  });

  // √©chappement simple
  function escapeHtml(s) {
    return String(s)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;');
  }

  // affichage local d'une d√©dicace
  function displayDedicace(obj) {
    const div = document.createElement('div');
    div.className = 'dedicace-entry';
    div.innerHTML = `<strong>${escapeHtml(obj.nom)} :</strong> ${escapeHtml(obj.message)}`;
    feed.prepend(div);

    file.push(` üéôÔ∏è ${obj.nom} : ${obj.message} `);
    if (file.length === 1) lancerDefilement();
  }

  // lecture initiale (les N derni√®res)
  db.ref('dedicaces').orderByChild('date').limitToLast(100).once('value')
    .then(snap => {
      const items = [];
      snap.forEach(child => {
        const d = child.val();
        if (d && d.nom && d.message) items.push(d);
      });
      items.reverse().forEach(displayDedicace);
    })
    .catch(err => console.warn('Erreur lecture initiale dedicaces:', err));

  // √©coute des nouveaux ajouts (en plus de la lecture initiale)
  db.ref('dedicaces').orderByChild('date').limitToLast(10).on('child_added', snap => {
    const d = snap.val();
    if (!d || !d.nom || !d.message) return;
    // √©viter doublons : si la d√©dicace a un timestamp tr√®s ancien, probablement d√©j√† affich√©e
    // ici on affiche toujours (ok si duplication minime)
    displayDedicace(d);
  });

  // envoi
  form.addEventListener('submit', e => {
    e.preventDefault();
    const nom = nomInput.value.trim();
    const message = msgInput.value.trim();
    if (!nom || !message) return alert('Nom et message requis.');

    // blacklist courte
    const blacklist = ["con","connard","merde","putain","salope","encul√©","fdp","tg","nique","bite","couille"];
    if (blacklist.some(m => message.toLowerCase().includes(m))) {
      return alert('Ton message contient un mot interdit. Merci de rester respectueux !');
    }

    const today = new Date().toISOString().split('T')[0];
    const last = localStorage.getItem('dedicaceDate');
    if (last === today) return alert("Tu as d√©j√† envoy√© une d√©dicace aujourd'hui.");

    const payload = { nom, message, date: Date.now() };

    db.ref('dedicaces').push(payload, err => {
      if (err) {
        console.error('Erreur push dedicace', err);
        alert('Erreur lors de l\'envoi. R√©essaie plus tard.');
      } else {
        // affichage imm√©diat (la listener realtime ajoutera aussi, mais on √©vite d'attendre)
        displayDedicace(payload);
        form.reset();
        charCount.textContent = '60 caract√®res restants';
        localStorage.setItem('dedicaceDate', today);
      }
    });
  });

  // d√©filement marquee
  function lancerDefilement() {
    if (!marquee || file.length === 0) return;
    marquee.textContent = file.join(' ‚Ä¢ ');
    marquee.style.transition = 'none';
    marquee.style.transform = 'translateX(100%)';
    setTimeout(() => {
      const largeur = marquee.scrollWidth;
      const vitesse = 100; // px par seconde
      const duree = (largeur + marquee.offsetWidth) / vitesse;
      marquee.style.transition = `transform ${duree}s linear`;
      marquee.style.transform = `translateX(-${largeur}px)`;
      setTimeout(lancerDefilement, duree * 1000 + 200);
    }, 50);
  }
})(firebase.database());
</script>
<!-- Statistiques GoatCounter -->
<script data-goatcounter="https://vafm.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
